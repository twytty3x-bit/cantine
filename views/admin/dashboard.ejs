<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Admin - Cantine</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css" crossorigin="anonymous" />
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;500;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="/css/admin.css">
</head>
<body>
    <div class="admin-container">
        <nav class="admin-sidebar">
            <div class="admin-logo">
                <h2>Cantine Admin</h2>
            </div>
            <ul class="admin-menu">
                <li class="active" data-tab="inventory">
                    <i class="fas fa-box"></i> Inventaire
                </li>
                <li data-tab="sales">
                    <i class="fas fa-chart-line"></i> Ventes
                </li>
                <li data-tab="reports">
                    <i class="fas fa-file-alt"></i> Rapports
                </li>
                <li data-tab="categories">
                    <i class="fas fa-tags"></i> Catégories
                </li>
                <li data-tab="coupons">
                    <i class="fas fa-ticket-alt"></i> Coupons
                </li>
                <li data-tab="users">
                    <i class="fas fa-users"></i> Utilisateurs
                </li>
                <li data-tab="import-export">
                    <i class="fas fa-download"></i> Import/Export
                </li>
                <li data-tab="tickets">
                    <i class="fas fa-ticket-alt"></i> Tirage au sort
                </li>
                <li data-tab="smtp">
                    <i class="fas fa-envelope"></i> Configuration SMTP
                </li>
            </ul>
            <div class="admin-footer">
                <a href="/" class="back-to-site">
                    <i class="fas fa-arrow-left"></i> Retour au site
                </a>
                <button onclick="logout()" class="logout-btn">
                    <i class="fas fa-sign-out-alt"></i> Déconnexion
                </button>
            </div>
        </nav>

        <main class="admin-content">
            <div class="tab-content active" id="inventory">
                <div class="section-header">
                    <h2>Inventaire</h2>
                    <button class="add-button" onclick="openAddProductModal()">
                        <i class="fas fa-plus"></i>
                        <span>Ajouter un produit</span>
                    </button>
                </div>
                <div class="inventory-grid">
                    <table id="inventory-table">
                        <thead>
                            <tr>
                                <th>Image</th>
                                <th>Nom</th>
                                <th>Catégorie</th>
                                <th>Prix de vente</th>
                                <th>Prix coûtant</th>
                                <th>Stock</th>
                                <th>Actions</th>
                            </tr>
                        </thead>
                        <tbody>
                            <!-- Rempli dynamiquement -->
                        </tbody>
                    </table>
                </div>
            </div>

            <div class="tab-content" id="sales">
                <div class="section-header">
                    <h2>Ventes</h2>
                    <div class="date-filter">
                        <label>Du:</label>
                        <input type="date" id="start-date">
                        <label>Au:</label>
                        <input type="date" id="end-date">
                        <button class="add-button" onclick="filterSales()">
                            <i class="fas fa-filter"></i>
                            <span>Filtrer</span>
                        </button>
                    </div>
                </div>
                
                <!-- Stats Cards -->
                <div class="sales-stats">
                    <div class="stat-card">
                        <h3>Ventes totales</h3>
                        <p id="total-sales">0.00$</p>
                    </div>
                    <div class="stat-card">
                        <h3>Profit</h3>
                        <p id="total-profit">0.00$</p>
                    </div>
                    <div class="stat-card">
                        <h3>Nombre de ventes</h3>
                        <p id="sales-count">0</p>
                    </div>
                </div>

                <!-- Historique des transactions -->
                <div class="sales-table-section">
                    <div class="table-header">
                        <h2>Historique des transactions</h2>
                        <div class="table-actions">
                            <div class="date-filter">
                                <label>Du:</label>
                                <input type="date" id="start-date">
                                <label>Au:</label>
                                <input type="date" id="end-date">
                                <button onclick="filterSales()" class="filter-btn">
                                    <i class="fas fa-filter"></i> Filtrer
                                </button>
                            </div>
                        </div>
                    </div>
                    <table id="sales-table">
                        <thead>
                            <tr>
                                <th>Date et heure</th>
                                <th>Articles vendus</th>
                                <th>Montant total</th>
                                <th>Profit</th>
                                <th>Coupon utilisé</th>
                                <th>Actions</th>
                            </tr>
                        </thead>
                        <tbody>
                            <!-- Rempli dynamiquement -->
                        </tbody>
                    </table>
                </div>
            </div>

            <div class="tab-content" id="reports">
                <div class="reports-header">
                    <div class="header-content">
                        <h1><i class="fas fa-chart-line"></i> Rapports de ventes</h1>
                        <p class="subtitle">Analysez vos performances et vos ventes</p>
                    </div>
                    <div class="date-filter-card">
                        <div class="filter-header">
                            <i class="fas fa-calendar-alt"></i>
                            <span>Période</span>
                        </div>
                        <div class="filter-inputs">
                            <div class="date-input-group">
                                <label for="report-start-date">Du</label>
                                <input type="date" id="report-start-date">
                            </div>
                            <div class="date-input-group">
                                <label for="report-end-date">Au</label>
                                <input type="date" id="report-end-date">
                            </div>
                            <button onclick="filterReports()" class="filter-btn-primary">
                                <i class="fas fa-filter"></i>
                                <span>Appliquer</span>
                            </button>
                            <button onclick="resetReportsFilter()" class="filter-btn-secondary">
                                <i class="fas fa-redo"></i>
                                <span>Réinitialiser</span>
                            </button>
                        </div>
                    </div>
                </div>

                <!-- Statistiques globales améliorées -->
                <div class="reports-summary-enhanced">
                    <div class="stat-card-enhanced sales">
                        <div class="stat-icon">
                            <i class="fas fa-dollar-sign"></i>
                        </div>
                        <div class="stat-content">
                            <h3>Ventes totales</h3>
                            <p class="stat-value" id="total-sales-value">0.00$</p>
                            <div class="stat-trend" id="sales-trend">
                                <i class="fas fa-arrow-up"></i>
                                <span>--</span>
                            </div>
                        </div>
                    </div>
                    <div class="stat-card-enhanced profit">
                        <div class="stat-icon">
                            <i class="fas fa-chart-line"></i>
                        </div>
                        <div class="stat-content">
                            <h3>Profit total</h3>
                            <p class="stat-value" id="total-profit-value">0.00$</p>
                            <div class="stat-trend" id="profit-trend">
                                <i class="fas fa-arrow-up"></i>
                                <span>--</span>
                            </div>
                        </div>
                    </div>
                    <div class="stat-card-enhanced transactions">
                        <div class="stat-icon">
                            <i class="fas fa-shopping-cart"></i>
                        </div>
                        <div class="stat-content">
                            <h3>Transactions</h3>
                            <p class="stat-value" id="total-transactions-value">0</p>
                            <div class="stat-trend" id="transactions-trend">
                                <i class="fas fa-arrow-up"></i>
                                <span>--</span>
                            </div>
                        </div>
                    </div>
                    <div class="stat-card-enhanced average">
                        <div class="stat-icon">
                            <i class="fas fa-calculator"></i>
                        </div>
                        <div class="stat-content">
                            <h3>Panier moyen</h3>
                            <p class="stat-value" id="average-cart-value">0.00$</p>
                            <div class="stat-trend" id="average-trend">
                                <i class="fas fa-arrow-up"></i>
                                <span>--</span>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- Rapports détaillés -->
                <div class="reports-grid-enhanced">
                    <!-- Ventes par produit -->
                    <div class="report-card-enhanced">
                        <div class="report-card-header">
                            <div class="report-title">
                                <i class="fas fa-box"></i>
                                <h3>Ventes par produit</h3>
                            </div>
                            <div class="report-actions">
                                <button class="icon-btn" onclick="exportProductSales()" title="Exporter">
                                    <i class="fas fa-download"></i>
                                </button>
                            </div>
                        </div>
                        <div class="report-card-body">
                            <div class="table-container-enhanced">
                                <table id="product-sales-table" class="data-table">
                                    <thead>
                                        <tr>
                                            <th>Produit</th>
                                            <th>Quantité</th>
                                            <th>Ventes</th>
                                            <th>Profit</th>
                                            <th>Performance</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        <!-- Rempli dynamiquement -->
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>

                    <!-- Ventes par catégorie -->
                    <div class="report-card-enhanced">
                        <div class="report-card-header">
                            <div class="report-title">
                                <i class="fas fa-tags"></i>
                                <h3>Ventes par catégorie</h3>
                            </div>
                        </div>
                        <div class="report-card-body">
                            <div class="category-chart-container" id="category-chart-container">
                                <!-- Graphique sera ajouté ici -->
                            </div>
                            <div class="table-container-enhanced">
                                <table id="category-sales-table" class="data-table">
                                    <thead>
                                        <tr>
                                            <th>Catégorie</th>
                                            <th>Ventes</th>
                                            <th>Profit</th>
                                            <th>% du total</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        <!-- Rempli dynamiquement -->
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>

                    <!-- Utilisation des coupons -->
                    <div class="report-card">
                        <h3>Utilisation des coupons</h3>
                        <div class="table-container">
                            <table id="coupon-usage-table">
                                <thead>
                                    <tr>
                                        <th>Code</th>
                                        <th>Type</th>
                                        <th>Valeur</th>
                                        <th>Utilisations</th>
                                        <th>Réduction totale</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <!-- Rempli dynamiquement -->
                                </tbody>
                            </table>
                        </div>
                    </div>

                    <!-- Ventes avec coupons -->
                    <div class="report-card">
                        <h3>Ventes avec coupons</h3>
                        <div class="table-container">
                            <table id="sales-with-coupons-table">
                                <thead>
                                    <tr>
                                        <th>Date</th>
                                        <th>Coupon</th>
                                        <th>Produits</th>
                                        <th>Total initial</th>
                                        <th>Réduction</th>
                                        <th>Total final</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <!-- Rempli dynamiquement -->
                                </tbody>
                            </table>
                        </div>
                    </div>

                    <!-- Produits vendus avec coupons -->
                    <div class="report-card">
                        <h3>Produits vendus avec coupons</h3>
                        <div class="table-container">
                            <table id="products-with-coupons-table">
                                <thead>
                                    <tr>
                                        <th>Produit</th>
                                        <th>Quantité vendue</th>
                                        <th>Nombre de coupons utilisés</th>
                                        <th>Réduction totale</th>
                                        <th>Total des ventes</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <!-- Rempli dynamiquement -->
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </div>

            <div class="tab-content" id="categories">
                <div class="section-header">
                    <h2>Gestion des catégories</h2>
                    <button class="add-button" onclick="openAddCategoryModal()">
                        <i class="fas fa-plus"></i>
                        <span>Ajouter une catégorie</span>
                    </button>
                </div>
                <div class="categories-grid">
                    <table id="categories-table">
                        <thead>
                            <tr>
                                <th>Nom</th>
                                <th>Statut</th>
                                <th>Actions</th>
                            </tr>
                        </thead>
                        <tbody>
                            <!-- Rempli dynamiquement -->
                        </tbody>
                    </table>
                </div>
            </div>

            <div id="coupons" class="tab-content">
                <div class="section-header">
                    <h2>Gestion des coupons</h2>
                    <button class="add-button" onclick="openAddCouponModal()">
                        <i class="fas fa-plus"></i>
                        <span>Ajouter un coupon</span>
                    </button>
                </div>
                <div class="coupons-grid">
                    <table id="coupons-table">
                        <thead>
                            <tr>
                                <th>Code</th>
                                <th>Type</th>
                                <th>Valeur</th>
                                <th>Période de validité</th>
                                <th>Utilisations</th>
                                <th>Statut</th>
                                <th>Actions</th>
                            </tr>
                        </thead>
                        <tbody>
                            <!-- Rempli dynamiquement -->
                        </tbody>
                    </table>
                </div>
            </div>

            <div class="tab-content" id="users">
                <div class="section-header">
                    <h2>Gestion des utilisateurs</h2>
                    <button class="add-button" onclick="openAddUserModal()">
                        <i class="fas fa-plus"></i>
                        <span>Ajouter un utilisateur</span>
                    </button>
                </div>
                <div class="users-grid">
                    <table id="users-table">
                        <thead>
                            <tr>
                                <th>Nom d'utilisateur</th>
                                <th>Rôle</th>
                                <th>Statut</th>
                                <th>Dernière connexion</th>
                                <th>Actions</th>
                            </tr>
                        </thead>
                        <tbody>
                            <!-- Rempli dynamiquement -->
                        </tbody>
                    </table>
                </div>
            </div>

            <div class="tab-content" id="import-export">
                <div class="section-header">
                    <h2>Import / Export des données</h2>
                </div>
                
                <div class="import-export-container">
                    <!-- Section Export -->
                    <div class="export-section">
                        <h3><i class="fas fa-download"></i> Exporter les données</h3>
                        <p>Exportez vos données dans un fichier JSON. Sélectionnez ce que vous souhaitez exporter.</p>
                        
                        <div class="export-options">
                            <h4>Options d'export :</h4>
                            <label class="checkbox-label">
                                <input type="checkbox" id="export-products" checked>
                                Exporter les produits
                            </label>
                            <label class="checkbox-label">
                                <input type="checkbox" id="export-categories" checked>
                                Exporter les catégories
                            </label>
                            <label class="checkbox-label">
                                <input type="checkbox" id="export-coupons" checked>
                                Exporter les coupons
                            </label>
                            <label class="checkbox-label">
                                <input type="checkbox" id="export-users">
                                Exporter les utilisateurs (sans mots de passe)
                            </label>
                            <label class="checkbox-label">
                                <input type="checkbox" id="export-sales">
                                Exporter les ventes
                            </label>
                        </div>
                        
                        <button class="add-button" onclick="exportData()">
                            <i class="fas fa-file-download"></i>
                            <span>Exporter les données</span>
                        </button>
                    </div>

                    <!-- Section Import -->
                    <div class="import-section">
                        <h3><i class="fas fa-upload"></i> Importer des données</h3>
                        <p>Importez des données depuis un fichier JSON exporté précédemment.</p>
                        
                        <div class="import-options">
                            <h4>Options d'import :</h4>
                            <label class="checkbox-label">
                                <input type="checkbox" id="import-products" checked>
                                Importer les produits
                            </label>
                            <label class="checkbox-label">
                                <input type="checkbox" id="import-categories" checked>
                                Importer les catégories
                            </label>
                            <label class="checkbox-label">
                                <input type="checkbox" id="import-coupons" checked>
                                Importer les coupons
                            </label>
                            <label class="checkbox-label">
                                <input type="checkbox" id="import-users">
                                Importer les utilisateurs (non recommandé)
                            </label>
                            <label class="checkbox-label">
                                <input type="checkbox" id="import-sales">
                                Importer les ventes
                            </label>
                            <label class="checkbox-label">
                                <input type="checkbox" id="import-overwrite">
                                Remplacer les données existantes
                            </label>
                        </div>
                        
                        <div class="file-input-container">
                            <input type="file" id="import-file" accept=".json,.zip" style="display: none;">
                            <button class="add-button" onclick="document.getElementById('import-file').click()">
                                <i class="fas fa-folder-open"></i>
                                <span>Sélectionner un fichier</span>
                            </button>
                            <span id="selected-file-name" class="file-name"></span>
                        </div>
                        
                        <button class="add-button" id="import-btn" onclick="importData()" disabled>
                            <i class="fas fa-file-upload"></i>
                            <span>Importer les données</span>
                        </button>
                        
                        <div id="import-results" class="import-results" style="display: none;"></div>
                    </div>
                </div>
            </div>

            <div class="tab-content" id="tickets">
                <div class="section-header">
                    <h2>Tirage au sort - Gestion des coupons</h2>
                    <a href="/tickets" target="_blank" class="add-button">
                        <i class="fas fa-external-link-alt"></i>
                        <span>Page d'achat</span>
                    </a>
                </div>

                <!-- Statistiques -->
                <div class="tickets-stats">
                    <div class="stat-card">
                        <h3>Total de coupons vendus</h3>
                        <p id="total-tickets">0</p>
                    </div>
                    <div class="stat-card">
                        <h3>Montant total</h3>
                        <p id="total-amount-stats">0.00$</p>
                    </div>
                    <div class="stat-card">
                        <h3>Gagnants</h3>
                        <p id="total-winners">0</p>
                    </div>
                    <div class="stat-card">
                        <h3>Tickets éligibles</h3>
                        <p id="eligible-tickets">0</p>
                    </div>
                </div>

                <!-- Section tirage au sort -->
                <div class="draw-section">
                    <h3><i class="fas fa-dice"></i> Effectuer un tirage au sort</h3>
                    <p>Tirez au hasard un gagnant parmi tous les coupons vendus (non gagnants et non annulés).</p>
                    <button class="add-button" onclick="drawWinner()" id="draw-btn">
                        <i class="fas fa-magic"></i>
                        <span>Tirer un gagnant</span>
                    </button>
                    <div id="draw-result" class="draw-result" style="display: none;"></div>
                </div>

                <!-- Liste des tickets -->
                <div class="tickets-list-section">
                    <div class="table-header">
                        <h3>Liste des coupons vendus</h3>
                        <div class="filters">
                            <input type="email" id="filter-email" placeholder="Filtrer par email...">
                            <select id="filter-winner">
                                <option value="">Tous</option>
                                <option value="true">Gagnants seulement</option>
                                <option value="false">Non gagnants seulement</option>
                            </select>
                            <select id="filter-status">
                                <option value="">Tous les statuts</option>
                                <option value="active">Actifs</option>
                                <option value="cancelled">Annulés</option>
                            </select>
                            <button onclick="loadTickets()" class="filter-btn">
                                <i class="fas fa-filter"></i> Filtrer
                            </button>
                        </div>
                    </div>
                    <table id="tickets-table">
                        <thead>
                            <tr>
                                <th>Numéro</th>
                                <th>Email</th>
                                <th>Date d'achat</th>
                                <th>Montant</th>
                                <th>Statut</th>
                                <th>Actions</th>
                            </tr>
                        </thead>
                        <tbody>
                            <!-- Rempli dynamiquement -->
                        </tbody>
                    </table>
                    <div id="tickets-pagination" class="pagination"></div>
                </div>

                <!-- Configuration des prix -->
                <div class="ticket-config-section">
                    <div class="section-header">
                        <h3><i class="fas fa-cog"></i> Configuration des prix</h3>
                        <button class="add-button" onclick="loadTicketConfig()">
                            <i class="fas fa-sync"></i>
                            <span>Actualiser</span>
                        </button>
                    </div>
                    
                    <div class="config-form-container">
                        <form id="ticket-config-form">
                            <div class="form-group">
                                <label for="ticket-base-price">
                                    <i class="fas fa-dollar-sign"></i>
                                    Prix de base par billet
                                </label>
                                <input type="number" id="ticket-base-price" step="0.01" min="0" required>
                                <small>Prix appliqué si aucune offre ne correspond</small>
                            </div>

                            <div class="form-group">
                                <label>
                                    <i class="fas fa-tags"></i>
                                    Offres par quantité
                                </label>
                                <div id="quantity-offers-list" class="quantity-offers-list">
                                    <!-- Les offres seront ajoutées ici -->
                                </div>
                                <button type="button" class="btn-secondary" onclick="addQuantityOffer()">
                                    <i class="fas fa-plus"></i>
                                    Ajouter une offre
                                </button>
                            </div>

                            <div class="form-buttons">
                                <button type="submit" class="btn-primary">
                                    <i class="fas fa-save"></i>
                                    Sauvegarder la configuration
                                </button>
                            </div>
                        </form>
                    </div>
                </div>

                <!-- Logs d'annulation -->
                <div class="tickets-logs-section">
                    <div class="table-header">
                        <h3><i class="fas fa-history"></i> Logs d'annulation</h3>
                        <button onclick="loadTicketLogs()" class="filter-btn">
                            <i class="fas fa-sync"></i> Actualiser
                        </button>
                    </div>
                    <table id="tickets-logs-table">
                        <thead>
                            <tr>
                                <th>Numéro de billet</th>
                                <th>Email</th>
                                <th>Date d'achat original</th>
                                <th>Montant</th>
                                <th>Annulé par</th>
                                <th>Date d'annulation</th>
                                <th>Raison</th>
                            </tr>
                        </thead>
                        <tbody>
                            <!-- Rempli dynamiquement -->
                        </tbody>
                    </table>
                    <div id="tickets-logs-pagination" class="pagination"></div>
                </div>

                <!-- Section réinitialisation -->
                <div class="reset-section" style="margin-top: 30px; padding: 20px; background: #fff3cd; border: 2px solid #ffc107; border-radius: 8px;">
                    <h3 style="color: #856404; margin-bottom: 10px;"><i class="fas fa-exclamation-triangle"></i> Zone de réinitialisation</h3>
                    <p style="color: #856404; margin-bottom: 15px;">Attention : Cette action supprimera <strong>TOUS</strong> les billets de manière permanente. Cette action ne peut pas être annulée.</p>
                    <button class="btn-danger" onclick="resetAllTickets()" id="reset-all-btn" style="padding: 12px 24px; font-size: 1rem;">
                        <i class="fas fa-trash-alt"></i>
                        <span>Supprimer tous les billets</span>
                    </button>
                </div>
            </div>

            <div class="tab-content" id="smtp">
                <div class="section-header">
                    <h2>Configuration SMTP</h2>
                    <p>Configurez les paramètres d'envoi d'emails pour les notifications et les tickets</p>
                </div>

                <div class="smtp-config-section">
                    <form id="smtp-config-form">
                        <div class="form-group">
                            <label for="smtp-host">
                                <i class="fas fa-server"></i>
                                Serveur SMTP (Host)
                            </label>
                            <input type="text" id="smtp-host" required placeholder="smtp.gmail.com">
                            <small>Exemple: smtp.gmail.com, smtp.outlook.com</small>
                        </div>

                        <div class="form-row">
                            <div class="form-group">
                                <label for="smtp-port">
                                    <i class="fas fa-network-wired"></i>
                                    Port
                                </label>
                                <input type="number" id="smtp-port" min="1" max="65535" required placeholder="587">
                                <small>587 (TLS) ou 465 (SSL)</small>
                            </div>

                            <div class="form-group">
                                <label for="smtp-secure">
                                    <i class="fas fa-lock"></i>
                                    Connexion sécurisée
                                </label>
                                <select id="smtp-secure" required>
                                    <option value="false">TLS (Port 587)</option>
                                    <option value="true">SSL (Port 465)</option>
                                </select>
                            </div>
                        </div>

                        <div class="form-group">
                            <label for="smtp-user">
                                <i class="fas fa-user"></i>
                                Nom d'utilisateur / Email
                            </label>
                            <input type="email" id="smtp-user" required placeholder="votre@email.com">
                            <small>L'adresse email utilisée pour l'authentification SMTP</small>
                        </div>

                        <div class="form-group">
                            <label for="smtp-password">
                                <i class="fas fa-key"></i>
                                Mot de passe / Mot de passe d'application
                            </label>
                            <input type="password" id="smtp-password" placeholder="Laissez vide pour conserver l'actuel">
                            <small id="smtp-password-info">Pour Gmail, utilisez un mot de passe d'application</small>
                        </div>

                        <div class="form-group">
                            <label for="smtp-from">
                                <i class="fas fa-paper-plane"></i>
                                Adresse email "De" (From)
                            </label>
                            <input type="email" id="smtp-from" required placeholder="noreply@cantine.com">
                            <small>L'adresse email qui apparaîtra comme expéditeur</small>
                        </div>

                        <div class="form-group">
                            <label for="smtp-from-name">
                                <i class="fas fa-user-tag"></i>
                                Nom de l'expéditeur
                            </label>
                            <input type="text" id="smtp-from-name" placeholder="Cantine">
                            <small>Le nom qui apparaîtra comme expéditeur (ex: "Cantine" au lieu de juste l'email)</small>
                        </div>

                        <div class="form-buttons">
                            <button type="submit" class="btn-primary">
                                <i class="fas fa-save"></i>
                                Sauvegarder la configuration
                            </button>
                            <button type="button" class="btn-secondary" onclick="testSMTPConfig()">
                                <i class="fas fa-paper-plane"></i>
                                Tester la configuration
                            </button>
                        </div>
                    </form>

                    <div id="smtp-test-section" class="smtp-test-section" style="display: none;">
                        <h3><i class="fas fa-vial"></i> Test d'envoi d'email</h3>
                        <div class="form-group">
                            <label for="test-email">
                                <i class="fas fa-envelope"></i>
                                Adresse email de test
                            </label>
                            <input type="email" id="test-email" placeholder="test@example.com">
                        </div>
                        <button class="btn-primary" onclick="sendTestEmail()">
                            <i class="fas fa-paper-plane"></i>
                            Envoyer un email de test
                        </button>
                        <div id="smtp-test-result" class="test-result"></div>
                    </div>
                </div>
            </div>
        </main>
    </div>

    <!-- Modal d'ajout/modification de produit -->
    <div id="product-modal" class="modal">
        <div class="modal-content">
            <span class="close">&times;</span>
            <h2>Ajouter un produit</h2>
            <form id="product-form" enctype="multipart/form-data">
                <div class="form-group">
                    <label for="product-name">Nom</label>
                    <input type="text" id="product-name" required>
                </div>
                <div class="form-group">
                    <label for="product-category">Catégorie</label>
                    <select id="product-category" required>
                        <!-- Rempli dynamiquement -->
                    </select>
                </div>
                <div class="form-group">
                    <label for="product-price">Prix unitaire</label>
                    <input type="text" 
                           id="product-price" 
                           pattern="[0-9]*[.,]?[0-9]*" 
                           required 
                           placeholder="0.000">
                </div>
                <div class="form-group">
                    <label for="product-cost">Prix d'achat</label>
                    <input type="number" id="product-cost" step="0.01" required>
                </div>
                <div class="form-group">
                    <label for="product-stock">Stock</label>
                    <input type="number" id="product-stock" required>
                </div>
                <div class="form-group">
                    <label for="product-image">Image</label>
                    <input type="file" id="product-image" accept="image/*">
                    <div class="image-preview" id="image-preview"></div>
                </div>
                <button type="submit">Sauvegarder</button>
            </form>
        </div>
    </div>

    <!-- Modal pour les catégories -->
    <div id="category-modal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>Ajouter une catégorie</h2>
                <span class="close">&times;</span>
            </div>
            <form id="category-form">
                <div class="form-group">
                    <label for="category-name">Nom de la catégorie</label>
                    <input type="text" id="category-name" required>
                </div>
                <div class="form-group">
                    <label>
                        <input type="checkbox" id="category-active">
                        Actif
                    </label>
                </div>
                <div class="form-buttons">
                    <button type="submit" class="btn btn-primary">Sauvegarder</button>
                    <button type="button" class="btn btn-secondary" onclick="document.getElementById('category-modal').style.display='none'">Annuler</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Ajouter un modal pour éditer les transactions -->
    <div id="sale-modal" class="modal">
        <div class="modal-content">
            <span class="close">&times;</span>
            <h2>Modifier la transaction</h2>
            <form id="sale-form">
                <div class="sale-items">
                    <!-- Les items seront ajoutés ici dynamiquement -->
                </div>
                <div class="form-group">
                    <label for="payment-received">Montant reçu</label>
                    <input type="number" id="payment-received" step="0.01" required>
                </div>
                <div class="form-actions">
                    <button type="submit" class="save-btn">Sauvegarder</button>
                    <button type="button" class="delete-btn" onclick="deleteSale()">Supprimer</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Ajouter le modal des coupons -->
    <div id="coupon-modal" class="modal">
        <div class="modal-content">
            <span class="close">&times;</span>
            <h2>Ajouter un coupon</h2>
            <form id="coupon-form">
                <div class="form-group">
                    <label for="coupon-code">Code</label>
                    <input type="text" id="coupon-code" required>
                </div>
                <div class="form-group">
                    <label for="coupon-type">Type de réduction</label>
                    <select id="coupon-type" required>
                        <option value="percentage">Pourcentage</option>
                        <option value="fixed">Montant fixe</option>
                    </select>
                </div>
                <div class="form-group">
                    <label for="coupon-value">Valeur</label>
                    <input type="number" id="coupon-value" min="0" step="0.01" required>
                </div>
                <div class="form-group">
                    <label for="coupon-start">Date de début</label>
                    <input type="date" id="coupon-start" required>
                </div>
                <div class="form-group">
                    <label for="coupon-end">Date de fin</label>
                    <input type="date" id="coupon-end" required>
                </div>
                <div class="form-group">
                    <label for="coupon-limit">Limite d'utilisation</label>
                    <input type="number" id="coupon-limit" min="0">
                    <small>Laisser vide pour illimité</small>
                </div>
                <div class="form-group">
                    <label class="checkbox-label">
                        <input type="checkbox" id="coupon-active" checked>
                        Coupon actif
                    </label>
                </div>
                <div class="form-group">
                    <label for="coupon-application">Type d'application</label>
                    <select id="coupon-application" required>
                        <option value="all">Tous les produits</option>
                        <option value="product">Produits spécifiques</option>
                        <option value="category">Catégories spécifiques</option>
                    </select>
                </div>

                <div class="form-group" id="products-selection" style="display: none;">
                    <label>Produits applicables</label>
                    <div class="products-list">
                        <!-- Rempli dynamiquement -->
                    </div>
                </div>

                <div class="form-group" id="categories-selection" style="display: none;">
                    <label>Catégories applicables</label>
                    <div class="categories-list">
                        <!-- Rempli dynamiquement -->
                    </div>
                </div>

                <button type="submit">Sauvegarder</button>
            </form>
        </div>
    </div>

    <!-- Ajouter le modal pour les utilisateurs -->
    <div id="user-modal" class="modal">
        <div class="modal-content">
            <span class="close">&times;</span>
            <h2>Ajouter un utilisateur</h2>
            <form id="user-form">
                <div class="form-group">
                    <label for="user-username">Nom d'utilisateur</label>
                    <input type="text" id="user-username" required>
                </div>
                <div class="form-group">
                    <label for="user-password">Mot de passe</label>
                    <input type="password" id="user-password" required>
                </div>
                <div class="form-group">
                    <label for="user-role">Rôle</label>
                    <select id="user-role" required>
                        <option value="user">Utilisateur</option>
                        <option value="admin">Administrateur</option>
                        <option value="ticket_seller">Vendeur de tickets</option>
                    </select>
                </div>
                <div class="form-group">
                    <label class="checkbox-label">
                        <input type="checkbox" id="user-active" checked>
                        Utilisateur actif
                    </label>
                </div>
                <button type="submit">Sauvegarder</button>
            </form>
        </div>
    </div>

    <!-- Modal pour changer le mot de passe -->
    <div id="password-modal" class="modal">
        <div class="modal-content">
            <span class="close">&times;</span>
            <h2>Changer le mot de passe</h2>
            <form id="password-form">
                <div class="form-group">
                    <label for="new-password">Nouveau mot de passe</label>
                    <input type="password" id="new-password" required>
                </div>
                <div class="form-group">
                    <label for="confirm-password">Confirmer le mot de passe</label>
                    <input type="password" id="confirm-password" required>
                </div>
                <div class="error-message" id="password-error"></div>
                <button type="submit">Mettre à jour</button>
            </form>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="/js/admin.js"></script>
</body>
</html> 